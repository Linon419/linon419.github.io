<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>线程 - Yang&#39;s Blog</title><meta name="Description" content="探索世界的好奇心万岁"><meta property="og:title" content="线程" />
<meta property="og:description" content="基本概念 多线程是Java语言的重要特性，大量应用于网络编程、服务器端程序的开发，最常见的UI界面底层原理、操作系统底层原理都大量使用了多线程" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yang419.com/posts/xian-cheng/" />
<meta property="article:published_time" content="2020-01-20T23:11:22+00:00" />
<meta property="article:modified_time" content="2020-01-20T23:11:22+00:00" /><meta property="og:site_name" content="Yang&#39;s Blog" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="线程"/>
<meta name="twitter:description" content="基本概念 多线程是Java语言的重要特性，大量应用于网络编程、服务器端程序的开发，最常见的UI界面底层原理、操作系统底层原理都大量使用了多线程"/>
<meta name="application-name" content="Yang&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="Yang&#39;s Blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://yang419.com/posts/xian-cheng/" /><link rel="prev" href="https://yang419.com/posts/io-liu/" /><link rel="next" href="https://yang419.com/posts/lambda/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "线程",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/yang419.com\/posts\/xian-cheng\/"
        },"genre": "posts","keywords": "Java","wordcount":  9508 ,
        "url": "https:\/\/yang419.com\/posts\/xian-cheng\/","datePublished": "2020-01-20T23:11:22+00:00","dateModified": "2020-01-20T23:11:22+00:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Yang"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Yang&#39;s Blog">Yang&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/about/"> 关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Yang&#39;s Blog">Yang&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/about/" title="">关于</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a>
           
        </div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">线程</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Yang</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/java/"><i class="far fa-folder fa-fw"></i>Java</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-01-20">2020-01-20</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 9508 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 19 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#程序">程序</a></li>
    <li><a href="#进程">进程</a></li>
    <li><a href="#线程">线程</a></li>
    <li><a href="#线程和进程的区别"><strong>线程和进程的区别</strong></a></li>
    <li><a href="#进程与程序的区别">进程与程序的区别</a></li>
  </ul>

  <ul>
    <li><a href="#通过继承thread类实现多线程"><strong>通过继承Thread类实现多线程</strong></a></li>
    <li><a href="#通过runnable接口实现多线程"><strong>通过Runnable接口实现多线程</strong></a></li>
  </ul>

  <ul>
    <li><a href="#终止线程的典型方式"><strong>终止线程的典型方式</strong></a></li>
    <li><a href="#暂停线程执行sleepyield"><strong>暂停线程执行sleep/yield</strong></a></li>
    <li><a href="#线程的联合">线程的联合</a></li>
  </ul>

  <ul>
    <li><a href="#线程的优先级">线程的优先级</a></li>
  </ul>

  <ul>
    <li><a href="#实现多线程同步">实现多线程同步</a></li>
    <li><a href="#死锁">死锁</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="基本概念">基本概念</h1>
<p>多线程是Java语言的重要特性，大量应用于网络编程、服务器端程序的开发，最常见的UI界面底层原理、操作系统底层原理都大量使用了多线程。</p>
<p>我们可以流畅的点击软件或者游戏中的各种按钮，其实，底层就是多线程的应用。UI界面的主线程绘制界面，如果有一个耗时的操作发生则启动新的线程，完全不影响主线程的工作。当这个线程工作完毕后，再更新到主界面上。</p>
<p>我们可以上百人、上千人、上万人同时访问某个网站，其实，也是基于网站服务器的多线程原理。如果没有多线程，服务器处理速度会极大降低。</p>
<p>多线程应用于计算机的各个方面，但是对于初学者，我们只需掌握基本的概念即可。在入门阶段，暂时没有必要钻研过深。</p>
<!-- more -->
<h2 id="程序">程序</h2>
<p>“程序(Program)”是一个静态的概念，一般对应于操作系统中的一个可执行文件，比如：我们要启动酷狗听音乐，则对应酷狗的可执行程序。当我们双击酷狗，则加载程序到内存中，开始执行该程序，于是产生了“进程”。</p>
<h2 id="进程">进程</h2>
<p>执行中的程序叫做进程(Process)，是一个动态的概念。现代的操作系统都可以同时启动多个进程。比如：我们在用酷狗听音乐，也可以使用eclipse写代码，也可以同时用浏览器查看网页。进程具有如下特点：</p>
<p>\1. 进程是程序的一次动态执行过程， 占用特定的地址空间。</p>
<p>\2. 每个进程由3部分组成：cpu、data、code。每个进程都是独立的，保有自己的cpu时间，代码和数据，即便用同一份程序产生好几个进程，它们之间还是拥有自己的这3样东西，这样的缺点是：浪费内存，cpu的负担较重。</p>
<p>\3. 多任务(Multitasking)操作系统将CPU时间动态地划分给每个进程，操作系统同时执行多个进程，每个进程独立运行。以进程的观点来看，它会以为自己独占CPU的使用权。</p>
<p>\4. 进程的查看</p>
<p>​     Windows系统: Ctrl+Alt+Del，启动任务管理器即可查看所有进程。</p>
<p>​     Unix系统: ps or top。</p>
<h2 id="线程">线程</h2>
<p>一个进程可以产生多个线程。同多个进程可以共享操作系统的某些资源一样，同一进程的多个线程也可以共享此进程的某些资源(比如：代码、数据)，所以线程又被称为轻量级进程(lightweight process)。</p>
<p>\1. 一个进程内部的一个执行单元，它是程序中的一个单一的顺序控制流程。</p>
<p>\2. 一个进程可拥有多个并行的(concurrent)线程。</p>
<p>\3. 一个进程中的多个线程共享相同的内存单元/内存地址空间，可以访问相同的变量和对象，而且它们从同一堆中分配对象并进行通信、数据交换和同步操作。</p>
<p>\4. 由于线程间的通信是在同一地址空间上进行的，所以不需要额外的通信机制，这就使得通信更简便而且信息传递的速度也更快。</p>
<p>\5. 线程的启动、中断、消亡，消耗的资源非常少。</p>
<h2 id="线程和进程的区别"><strong>线程和进程的区别</strong></h2>
<p>\1. 每个进程都有独立的代码和数据空间(进程上下文)，进程间的切换会有较大的开销。</p>
<p>\2. 线程可以看成是轻量级的进程，属于同一进程的线程共享代码和数据空间，每个线程有独立的运行栈和程序计数器(PC)，线程切换的开销小。</p>
<p>\3. 线程和进程最根本的区别在于：进程是资源分配的单位，线程是调度和执行的单位。</p>
<p>\4. 多进程: 在操作系统中能同时运行多个任务(程序)。</p>
<p>\5. 多线程: 在同一应用程序中有多个顺序流同时执行。</p>
<p>\6. 线程是进程的一部分，所以线程有的时候被称为轻量级进程。</p>
<p>\7. 一个没有线程的进程是可以被看作单线程的，如果一个进程内拥有多个线程，进程的执行过程不是一条线(线程)的，而是多条线(线程)共同完成的。</p>
<p>\8.  系统在运行的时候会为每个进程分配不同的内存区域，但是不会为线程分配内存(线程所使用的资源是它所属的进程的资源)，线程组只能共享资源。那就是说，除了CPU之外(线程在运行的时候要占用CPU资源)，计算机内部的软硬件资源的分配与线程无关，线程只能共享它所属进程的资源。</p>
<h2 id="进程与程序的区别">进程与程序的区别</h2>
<p>程序是一组指令的集合，它是静态的实体，没有执行的含义。而进程是一个动态的实体，有自己的生命周期。一般说来，一个进程肯定与一个程序相对应，并且只有一个，但是一个程序可以有多个进程，或者一个进程都没有。除此之外，进程还有并发性和交往性。简单地说，进程是程序的一部分，程序运行的时候会产生进程。</p>
<h1 id="java中如何实现多线程"><strong>Java中如何实现多线程</strong></h1>
<p>在Java中使用多线程非常简单，我们先学习如何创建和使用线程，然后再结合案例深入剖析线程的特性。</p>
<h2 id="通过继承thread类实现多线程"><strong>通过继承Thread类实现多线程</strong></h2>
<p>继承Thread类实现多线程的步骤：</p>
<p>\1. 在Java中负责实现线程功能的类是java.lang.Thread 类。</p>
<p>\2. 可以通过创建 Thread的实例来创建新的线程。</p>
<p>\3. 每个线程都是通过某个特定的Thread对象所对应的方法run( )来完成其操作的，方法run( )称为线程体。</p>
<p>\4. 通过调用Thread类的start()方法来启动一个线程。</p>
<p>**此种方式的缺点：**如果我们的类已经继承了一个类(如小程序必须继承自 Applet 类)，则无法再继承 Thread 类。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestThread</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span><span class="c1">//自定义类继承Thread类
</span><span class="c1"></span>    <span class="c1">//run()方法里是线程体
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;:&#34;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span><span class="c1">//getName()方法是返回线程名称
</span><span class="c1"></span>        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">TestThread</span> <span class="n">thread1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TestThread</span><span class="o">();</span><span class="c1">//创建线程对象
</span><span class="c1"></span>        <span class="n">thread1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span><span class="c1">//启动线程
</span><span class="c1"></span>        <span class="n">TestThread</span> <span class="n">thread2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TestThread</span><span class="o">();</span>
        <span class="n">thread2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="通过runnable接口实现多线程"><strong>通过Runnable接口实现多线程</strong></h2>
<p>在开发中，我们应用更多的是通过Runnable接口实现多线程。这种方式克服了11.2.1节中实现线程类的缺点，即在实现Runnable接口的同时还可以继承某个类。所以实现Runnable接口的方式要通用一些。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Demo02</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()+</span><span class="s">&#34;:&#34;</span><span class="o">+</span><span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Thread</span> <span class="n">th1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Demo02</span><span class="o">());</span>
        <span class="n">th1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">Thread</span> <span class="n">th2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Demo02</span><span class="o">());</span>
        
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h1 id="线程状态">线程状态</h1>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/Linon419/Img/master/post-images/1579522358405.png"
        data-srcset="https://raw.githubusercontent.com/Linon419/Img/master/post-images/1579522358405.png, https://raw.githubusercontent.com/Linon419/Img/master/post-images/1579522358405.png 1.5x, https://raw.githubusercontent.com/Linon419/Img/master/post-images/1579522358405.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/Linon419/Img/master/post-images/1579522358405.png"
        title="https://raw.githubusercontent.com/Linon419/Img/master/post-images/1579522358405.png" />
一个线程对象在它的生命周期内，需要经历5个状态。</p>
<p><strong>▪ 新生状态(New)</strong></p>
<p>用new关键字建立一个线程对象后，该线程对象就处于新生状态。处于新生状态的线程有自己的内存空间，通过调用start方法进入就绪状态。</p>
<p><strong>▪ 就绪状态(Runnable)</strong></p>
<p>处于就绪状态的线程已经具备了运行条件，但是还没有被分配到CPU，处于“线程就绪队列”，等待系统为其分配CPU。就绪状态并不是执行状态，当系统选定一个等待执行的Thread对象后，它就会进入执行状态。一旦获得CPU，线程就进入运行状态并自动调用自己的run方法。有4中原因会导致线程进入就绪状态：</p>
<ol>
<li>
<p>新建线程：调用start()方法，进入就绪状态;</p>
</li>
<li>
<p>阻塞线程：阻塞解除，进入就绪状态;</p>
</li>
<li>
<p>运行线程：调用yield()方法，直接进入就绪状态;</p>
</li>
<li>
<p>运行线程：JVM将CPU资源从本线程切换到其他线程。</p>
</li>
</ol>
<p><strong>▪ 运行状态(Running)</strong></p>
<p>在运行状态的线程执行自己run方法中的代码，直到调用其他方法而终止或等待某资源而阻塞或完成任务而死亡。如果在给定的时间片内没有执行结束，就会被系统给换下来回到就绪状态。也可能由于某些“导致阻塞的事件”而进入阻塞状态。</p>
<p><strong>▪ 阻塞状态(Blocked)</strong></p>
<p>阻塞指的是暂停一个线程的执行以等待某个条件发生(如某资源就绪)。有4种原因会导致阻塞：</p>
<p>\1. 执行sleep(int millsecond)方法，使当前线程休眠，进入阻塞状态。当指定的时间到了后，线程进入就绪状态。</p>
<p>\2. 执行wait()方法，使当前线程进入阻塞状态。当使用nofity()方法唤醒这个线程后，它进入就绪状态。</p>
<p>\3. 线程运行时，某个操作进入阻塞状态，比如执行IO流操作(read()/write()方法本身就是阻塞的方法)。只有当引起该操作阻塞的原因消失后，线程进入就绪状态。</p>
<p>\4. join()线程联合: 当某个线程等待另一个线程执行结束后，才能继续执行时，使用join()方法。</p>
<p><strong>▪ 死亡状态(Terminated)</strong></p>
<p>死亡状态是线程生命周期中的最后一个阶段。线程死亡的原因有两个。一个是正常运行的线程完成了它run()方法内的全部工作; 另一个是线程被强制终止，如通过执行stop()或destroy()方法来终止一个线程(注：stop()/destroy()方法已经被JDK废弃，不推荐使用)。</p>
<p>当一个线程进入死亡状态以后，就不能再回到其它状态了。</p>
<h2 id="终止线程的典型方式"><strong>终止线程的典型方式</strong></h2>
<p>终止线程我们一般不使用JDK提供的stop()/destroy()方法(它们本身也被JDK废弃了)。通常的做法是提供一个boolean型的终止变量，当这个变量置为false，则终止线程的运行。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestThreadCiycle</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kt">boolean</span> <span class="n">live</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span><span class="c1">// 标记变量，表示线程是否可中止；
</span><span class="c1"></span>    <span class="kd">public</span> <span class="nf">TestThreadCiycle</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="c1">//当live的值是true时，继续线程体；false则结束循环，继而终止线程体；
</span><span class="c1"></span>        <span class="k">while</span> <span class="o">(</span><span class="n">live</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">name</span> <span class="o">+</span> <span class="o">(</span><span class="n">i</span><span class="o">++));</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">terminate</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">live</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">TestThreadCiycle</span> <span class="n">ttc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TestThreadCiycle</span><span class="o">(</span><span class="s">&#34;线程A:&#34;</span><span class="o">);</span>
        <span class="n">Thread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">ttc</span><span class="o">);</span><span class="c1">// 新生状态
</span><span class="c1"></span>        <span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span><span class="c1">// 就绪状态
</span><span class="c1"></span>        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">100</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;主线程&#34;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">ttc</span><span class="o">.</span><span class="na">terminate</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;ttc stop!&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="o">-----------------------</span>
  <span class="n">no</span><span class="o">.</span><span class="na">10</span>
<span class="n">主线程0</span>
<span class="n">主线程1</span>
<span class="n">no</span><span class="o">.</span><span class="na">11</span>
<span class="n">no</span><span class="o">.</span><span class="na">12</span>
<span class="n">no</span><span class="o">.</span><span class="na">13</span>
<span class="n">主线程2</span>
<span class="n">主线程3</span>
<span class="n">主线程4</span>
<span class="n">主线程5</span>
<span class="n">主线程6</span>
<span class="n">主线程7</span>
<span class="n">主线程8</span>
<span class="n">no</span><span class="o">.</span><span class="na">14</span>
<span class="n">主线程9</span>
<span class="n">主线程10</span>
<span class="n">主线程11</span>
<span class="n">no</span><span class="o">.</span><span class="na">15</span>
<span class="n">主线程12</span>
<span class="n">主线程13</span>
<span class="n">主线程14</span>
<span class="n">no</span><span class="o">.</span><span class="na">16</span>
<span class="n">主线程15</span>
<span class="n">no</span><span class="o">.</span><span class="na">17</span>
<span class="n">主线程16</span>
<span class="n">no</span><span class="o">.</span><span class="na">18</span>
<span class="n">主线程17</span>
<span class="n">no</span><span class="o">.</span><span class="na">19</span>
<span class="n">主线程18</span>
<span class="n">no</span><span class="o">.</span><span class="na">110</span>
<span class="n">主线程19</span>
<span class="n">no</span><span class="o">.</span><span class="na">111</span>
<span class="n">主线程20</span>
<span class="n">no</span><span class="o">.</span><span class="na">112</span>
<span class="n">主线程21</span>
<span class="n">no</span><span class="o">.</span><span class="na">113</span>
<span class="n">主线程22</span>
<span class="n">no</span><span class="o">.</span><span class="na">114</span>
<span class="n">主线程23</span>
<span class="n">no</span><span class="o">.</span><span class="na">115</span>
<span class="n">主线程24</span>
<span class="n">no</span><span class="o">.</span><span class="na">116</span>
<span class="n">主线程25</span>
<span class="n">no</span><span class="o">.</span><span class="na">117</span>
<span class="n">主线程26</span>
<span class="n">no</span><span class="o">.</span><span class="na">118</span>
<span class="n">主线程27</span>
<span class="n">no</span><span class="o">.</span><span class="na">119</span>
<span class="n">主线程28</span>
<span class="n">no</span><span class="o">.</span><span class="na">120</span>
<span class="n">no</span><span class="o">.</span><span class="na">121</span>
<span class="n">主线程29</span>
<span class="n">no</span><span class="o">.</span><span class="na">122</span>
<span class="n">no</span><span class="o">.</span><span class="na">123</span>
<span class="n">no</span><span class="o">.</span><span class="na">124</span>
<span class="n">no</span><span class="o">.</span><span class="na">125</span>
<span class="n">no</span><span class="o">.</span><span class="na">126</span>
<span class="n">no</span><span class="o">.</span><span class="na">127</span>
<span class="n">主线程30</span>
<span class="n">no</span><span class="o">.</span><span class="na">128</span>
<span class="n">主线程31</span>
<span class="n">主线程32</span>
<span class="n">no</span><span class="o">.</span><span class="na">129</span>
<span class="n">主线程33</span>
<span class="n">no</span><span class="o">.</span><span class="na">130</span>
<span class="n">no</span><span class="o">.</span><span class="na">131</span>
<span class="n">no</span><span class="o">.</span><span class="na">132</span>
<span class="n">no</span><span class="o">.</span><span class="na">133</span>
<span class="n">no</span><span class="o">.</span><span class="na">134</span>
<span class="n">no</span><span class="o">.</span><span class="na">135</span>
<span class="n">no</span><span class="o">.</span><span class="na">136</span>
<span class="n">no</span><span class="o">.</span><span class="na">137</span>
<span class="n">no</span><span class="o">.</span><span class="na">138</span>
<span class="n">no</span><span class="o">.</span><span class="na">139</span>
<span class="n">no</span><span class="o">.</span><span class="na">140</span>
<span class="n">no</span><span class="o">.</span><span class="na">141</span>
<span class="n">no</span><span class="o">.</span><span class="na">142</span>
<span class="n">no</span><span class="o">.</span><span class="na">143</span>
<span class="n">no</span><span class="o">.</span><span class="na">144</span>
<span class="n">no</span><span class="o">.</span><span class="na">145</span>
<span class="n">主线程34</span>
<span class="n">主线程35</span>
<span class="n">主线程36</span>
<span class="n">主线程37</span>
<span class="n">主线程38</span>
<span class="n">no</span><span class="o">.</span><span class="na">146</span>
<span class="n">主线程39</span>
<span class="n">no</span><span class="o">.</span><span class="na">147</span>
<span class="n">主线程40</span>
<span class="n">no</span><span class="o">.</span><span class="na">148</span>
<span class="n">主线程41</span>
<span class="n">no</span><span class="o">.</span><span class="na">149</span>
<span class="n">主线程42</span>
<span class="n">no</span><span class="o">.</span><span class="na">150</span>
<span class="n">主线程43</span>
<span class="n">主线程44</span>
<span class="n">主线程45</span>
<span class="n">主线程46</span>
<span class="n">主线程47</span>
<span class="n">主线程48</span>
<span class="n">主线程49</span>
<span class="n">主线程50</span>
<span class="n">主线程51</span>
<span class="n">主线程52</span>
<span class="n">主线程53</span>
<span class="n">主线程54</span>
<span class="n">主线程55</span>
<span class="n">主线程56</span>
<span class="n">主线程57</span>
<span class="n">no</span><span class="o">.</span><span class="na">151</span>
<span class="n">主线程58</span>
<span class="n">主线程59</span>
<span class="n">主线程60</span>
<span class="n">主线程61</span>
<span class="n">主线程62</span>
<span class="n">主线程63</span>
<span class="n">主线程64</span>
<span class="n">主线程65</span>
<span class="n">主线程66</span>
<span class="n">主线程67</span>
<span class="n">no</span><span class="o">.</span><span class="na">152</span>
<span class="n">主线程68</span>
<span class="n">no</span><span class="o">.</span><span class="na">153</span>
<span class="n">no</span><span class="o">.</span><span class="na">154</span>
<span class="n">no</span><span class="o">.</span><span class="na">155</span>
<span class="n">no</span><span class="o">.</span><span class="na">156</span>
<span class="n">no</span><span class="o">.</span><span class="na">157</span>
<span class="n">no</span><span class="o">.</span><span class="na">158</span>
<span class="n">主线程69</span>
<span class="n">主线程70</span>
<span class="n">主线程71</span>
<span class="n">no</span><span class="o">.</span><span class="na">159</span>
<span class="n">主线程72</span>
<span class="n">no</span><span class="o">.</span><span class="na">160</span>
<span class="n">主线程73</span>
<span class="n">主线程74</span>
<span class="n">主线程75</span>
<span class="n">no</span><span class="o">.</span><span class="na">161</span>
<span class="n">主线程76</span>
<span class="n">no</span><span class="o">.</span><span class="na">162</span>
<span class="n">no</span><span class="o">.</span><span class="na">163</span>
<span class="n">主线程77</span>
<span class="n">no</span><span class="o">.</span><span class="na">164</span>
<span class="n">no</span><span class="o">.</span><span class="na">165</span>
<span class="n">no</span><span class="o">.</span><span class="na">166</span>
<span class="n">主线程78</span>
<span class="n">no</span><span class="o">.</span><span class="na">167</span>
<span class="n">主线程79</span>
<span class="n">no</span><span class="o">.</span><span class="na">168</span>
<span class="n">主线程80</span>
<span class="n">no</span><span class="o">.</span><span class="na">169</span>
<span class="n">no</span><span class="o">.</span><span class="na">170</span>
<span class="n">no</span><span class="o">.</span><span class="na">171</span>
<span class="n">no</span><span class="o">.</span><span class="na">172</span>
<span class="n">no</span><span class="o">.</span><span class="na">173</span>
<span class="n">no</span><span class="o">.</span><span class="na">174</span>
<span class="n">no</span><span class="o">.</span><span class="na">175</span>
<span class="n">no</span><span class="o">.</span><span class="na">176</span>
<span class="n">no</span><span class="o">.</span><span class="na">177</span>
<span class="n">no</span><span class="o">.</span><span class="na">178</span>
<span class="n">no</span><span class="o">.</span><span class="na">179</span>
<span class="n">no</span><span class="o">.</span><span class="na">180</span>
<span class="n">no</span><span class="o">.</span><span class="na">181</span>
<span class="n">no</span><span class="o">.</span><span class="na">182</span>
<span class="n">no</span><span class="o">.</span><span class="na">183</span>
<span class="n">no</span><span class="o">.</span><span class="na">184</span>
<span class="n">no</span><span class="o">.</span><span class="na">185</span>
<span class="n">no</span><span class="o">.</span><span class="na">186</span>
<span class="n">no</span><span class="o">.</span><span class="na">187</span>
<span class="n">no</span><span class="o">.</span><span class="na">188</span>
<span class="n">no</span><span class="o">.</span><span class="na">189</span>
<span class="n">no</span><span class="o">.</span><span class="na">190</span>
<span class="n">no</span><span class="o">.</span><span class="na">191</span>
<span class="n">no</span><span class="o">.</span><span class="na">192</span>
<span class="n">no</span><span class="o">.</span><span class="na">193</span>
<span class="n">no</span><span class="o">.</span><span class="na">194</span>
<span class="n">no</span><span class="o">.</span><span class="na">195</span>
<span class="n">no</span><span class="o">.</span><span class="na">196</span>
<span class="n">no</span><span class="o">.</span><span class="na">197</span>
<span class="n">no</span><span class="o">.</span><span class="na">198</span>
<span class="n">no</span><span class="o">.</span><span class="na">199</span>
<span class="n">no</span><span class="o">.</span><span class="na">1100</span>
<span class="n">主线程81</span>
<span class="n">主线程82</span>
<span class="n">no</span><span class="o">.</span><span class="na">1101</span>
<span class="n">no</span><span class="o">.</span><span class="na">1102</span>
<span class="n">no</span><span class="o">.</span><span class="na">1103</span>
<span class="n">no</span><span class="o">.</span><span class="na">1104</span>
<span class="n">no</span><span class="o">.</span><span class="na">1105</span>
<span class="n">no</span><span class="o">.</span><span class="na">1106</span>
<span class="n">no</span><span class="o">.</span><span class="na">1107</span>
<span class="n">no</span><span class="o">.</span><span class="na">1108</span>
<span class="n">no</span><span class="o">.</span><span class="na">1109</span>
<span class="n">no</span><span class="o">.</span><span class="na">1110</span>
<span class="n">no</span><span class="o">.</span><span class="na">1111</span>
<span class="n">no</span><span class="o">.</span><span class="na">1112</span>
<span class="n">no</span><span class="o">.</span><span class="na">1113</span>
<span class="n">no</span><span class="o">.</span><span class="na">1114</span>
<span class="n">主线程83</span>
<span class="n">主线程84</span>
<span class="n">主线程85</span>
<span class="n">主线程86</span>
<span class="n">主线程87</span>
<span class="n">主线程88</span>
<span class="n">主线程89</span>
<span class="n">主线程90</span>
<span class="n">主线程91</span>
<span class="n">主线程92</span>
<span class="n">主线程93</span>
<span class="n">no</span><span class="o">.</span><span class="na">1115</span>
<span class="n">主线程94</span>
<span class="n">主线程95</span>
<span class="n">主线程96</span>
<span class="n">主线程97</span>
<span class="n">主线程98</span>
<span class="n">主线程99</span>
<span class="n">tcc</span> <span class="n">stop</span>
<span class="n">no</span><span class="o">.</span><span class="na">1116</span>

</code></pre></td></tr></table>
</div>
</div><h2 id="暂停线程执行sleepyield"><strong>暂停线程执行sleep/yield</strong></h2>
<p>暂停线程执行常用的方法有sleep()和yield()方法，这两个方法的区别是：</p>
<ol>
<li>
<p>sleep()方法：可以让正在运行的线程进入阻塞状态，直到休眠时间满了，进入就绪状态。</p>
</li>
<li>
<p>yield()方法：可以让正在运行的线程直接进入就绪状态，让出CPU的使用权。</p>
</li>
</ol>
<p>暂停（sleep）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestThreadState</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">StateThread</span> <span class="n">thread1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StateThread</span><span class="o">();</span>
        <span class="n">thread1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">StateThread</span> <span class="n">thread2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StateThread</span><span class="o">();</span>
        <span class="n">thread2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//使用继承方式实现多线程
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">StateThread</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">100</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;:&#34;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">2000</span><span class="o">);</span><span class="c1">//调用线程的sleep()方法；
</span><span class="c1"></span>            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>暂停线程方法（yield）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestThreadState</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">StateThread</span> <span class="n">thread1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StateThread</span><span class="o">();</span>
        <span class="n">thread1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">StateThread</span> <span class="n">thread2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StateThread</span><span class="o">();</span>
        <span class="n">thread2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//使用继承方式实现多线程
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">StateThread</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">100</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;:&#34;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">yield</span><span class="o">();</span><span class="c1">//调用线程的yield()方法；
</span><span class="c1"></span>        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="线程的联合">线程的联合</h2>
<p>线程A在运行期间，可以调用线程B的join()方法，让线程B和线程A联合。这样，线程A就必须等待线程B执行完毕后，才能继续执行。如下面示例中，“爸爸线程”要抽烟，于是联合了“儿子线程”去买烟，必须等待“儿子线程”买烟完毕，“爸爸线程”才能继续抽烟。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Demo05</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Thread</span> <span class="n">fa</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">FatherThread</span><span class="o">());</span>
        <span class="n">fa</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">FatherThread</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Your father wants to smoke&#34;</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Go out and buy it&#34;</span><span class="o">);</span>
            <span class="n">Thread</span> <span class="n">son</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">SonThread</span><span class="o">());</span>
            <span class="n">son</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Father is waiting&#34;</span><span class="o">);</span>
            <span class="k">try</span><span class="o">{</span>
                <span class="n">son</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Where is my son&#34;</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Father is so happy&#34;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

    <span class="kd">class</span> <span class="nc">SonThread</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Go out and but it&#34;</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;It needs 10 mins&#34;</span><span class="o">);</span>
            <span class="k">try</span><span class="o">{</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;第&#34;</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s">&#34;分钟&#34;</span><span class="o">);</span>
                    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">1000</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;I am back&#34;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="获取线程基本信息的方法"><strong>获取线程基本信息的方法</strong></h1>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/Linon419/Img/master/post-images/1579522394614.png"
        data-srcset="https://raw.githubusercontent.com/Linon419/Img/master/post-images/1579522394614.png, https://raw.githubusercontent.com/Linon419/Img/master/post-images/1579522394614.png 1.5x, https://raw.githubusercontent.com/Linon419/Img/master/post-images/1579522394614.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/Linon419/Img/master/post-images/1579522394614.png"
        title="https://raw.githubusercontent.com/Linon419/Img/master/post-images/1579522394614.png" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestThread</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">argc</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">Runnable</span> <span class="n">r</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyThread</span><span class="o">();</span>
        <span class="n">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">r</span><span class="o">,</span> <span class="s">&#34;Name test&#34;</span><span class="o">);</span><span class="c1">//定义线程对象，并传入参数；
</span><span class="c1"></span>        <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span><span class="c1">//启动线程；
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;name is: &#34;</span> <span class="o">+</span> <span class="n">t</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span><span class="c1">//输出线程名称；
</span><span class="c1"></span>        <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">sleep</span><span class="o">(</span><span class="n">5000</span><span class="o">);</span><span class="c1">//线程暂停5分钟；
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">isAlive</span><span class="o">());</span><span class="c1">//判断线程还在运行吗？
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;over!&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
    <span class="c1">//线程体；
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="线程的优先级">线程的优先级</h2>
<ol>
<li>
<p>处于就绪状态的线程，会进入“就绪队列”等待JVM来挑选。</p>
</li>
<li>
<p>线程的优先级用数字表示，范围从1到10，一个线程的缺省优先级是5。</p>
</li>
<li>
<p>使用下列方法获得或设置线程对象的优先级。</p>
</li>
</ol>
<p>​     int getPriority();</p>
<p>​     void setPriority(int newPriority);</p>
<p>注意：优先级低只是意味着获得调度的概率低。并不是绝对先调用优先级高的线程后调用优先级低的线程。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestThread</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Thread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">MyThread</span><span class="o">(),</span> <span class="s">&#34;t1&#34;</span><span class="o">);</span>
        <span class="n">Thread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">MyThread</span><span class="o">(),</span> <span class="s">&#34;t2&#34;</span><span class="o">);</span>
        <span class="n">t1</span><span class="o">.</span><span class="na">setPriority</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
        <span class="n">t2</span><span class="o">.</span><span class="na">setPriority</span><span class="o">(</span><span class="n">10</span><span class="o">);</span>
        <span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">t2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>
    
</code></pre></td></tr></table>
</div>
</div><h1 id="什么是线程同步"><strong>什么是线程同步</strong></h1>
<p><strong>▪ 同步问题的提出</strong></p>
<p>现实生活中，我们会遇到“同一个资源，多个人都想使用”的问题。 比如：教室里，只有一台电脑，多个人都想使用。天然的解决办法就是，在电脑旁边，大家排队。前一人使用完后，后一人再使用。</p>
<p><strong>▪ 线程同步的概念</strong></p>
<p>处理多线程问题时，多个线程访问同一个对象，并且某些线程还想修改这个对象。 这时候，我们就需要用到“线程同步”。 线程同步其实就是一种等待机制，多个需要同时访问此对象的线程进入这个对象的等待池形成队列，等待前面的线程使用完毕后，下一个线程再使用。</p>
<p><strong>多线程操作同一个对象(未使用线程同步)</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestSync</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Account</span> <span class="n">a1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Account</span><span class="o">(</span><span class="n">100</span><span class="o">,</span> <span class="s">&#34;高&#34;</span><span class="o">);</span>
        <span class="n">Drawing</span> <span class="n">draw1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Drawing</span><span class="o">(</span><span class="n">80</span><span class="o">,</span> <span class="n">a1</span><span class="o">);</span><span class="c1">// 定义取钱线程对象；
</span><span class="c1"></span>        <span class="n">Drawing</span> <span class="n">draw2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Drawing</span><span class="o">(</span><span class="n">80</span><span class="o">,</span> <span class="n">a1</span><span class="o">);</span><span class="c1">// 定义取钱线程对象；
</span><span class="c1"></span>        <span class="n">draw1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span> <span class="c1">// 你取钱
</span><span class="c1"></span>        <span class="n">draw2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span> <span class="c1">// 你老婆取钱
</span><span class="c1"></span>    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
</span><span class="cm"> * 简单表示银行账户
</span><span class="cm"> */</span>
<span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">money</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">aname</span><span class="o">;</span>
 
    <span class="kd">public</span> <span class="nf">Account</span><span class="o">(</span><span class="kt">int</span> <span class="n">money</span><span class="o">,</span> <span class="n">String</span> <span class="n">aname</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">money</span> <span class="o">=</span> <span class="n">money</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">aname</span> <span class="o">=</span> <span class="n">aname</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/**
</span><span class="cm"> * 模拟提款操作
</span><span class="cm"> */</span>
<span class="kd">class</span> <span class="nc">Drawing</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">drawingNum</span><span class="o">;</span> <span class="c1">// 取多少钱
</span><span class="c1"></span>    <span class="n">Account</span> <span class="n">account</span><span class="o">;</span> <span class="c1">// 要取钱的账户
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">expenseTotal</span><span class="o">;</span> <span class="c1">// 总共取的钱数
</span><span class="c1"></span> 
    <span class="kd">public</span> <span class="nf">Drawing</span><span class="o">(</span><span class="kt">int</span> <span class="n">drawingNum</span><span class="o">,</span> <span class="n">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">drawingNum</span> <span class="o">=</span> <span class="n">drawingNum</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">account</span> <span class="o">=</span> <span class="n">account</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">account</span><span class="o">.</span><span class="na">money</span> <span class="o">-</span> <span class="n">drawingNum</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">1000</span><span class="o">);</span> <span class="c1">// 判断完后阻塞。其他线程开始运行。
</span><span class="c1"></span>        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">account</span><span class="o">.</span><span class="na">money</span> <span class="o">-=</span> <span class="n">drawingNum</span><span class="o">;</span>
        <span class="n">expenseTotal</span> <span class="o">+=</span> <span class="n">drawingNum</span><span class="o">;</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;--账户余额：&#34;</span> <span class="o">+</span> <span class="n">account</span><span class="o">.</span><span class="na">money</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;--总共取了：&#34;</span> <span class="o">+</span> <span class="n">expenseTotal</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>没有线程同步机制，两个线程同时操作同一个账户对象，竟然从只有100元的账户，轻松取出80*2=160元，账户余额竟然成为了-60。这么大的问题，显然银行不会答应的。</p>
<h2 id="实现多线程同步">实现多线程同步</h2>
<p>由于同一进程的多个线程共享同一块存储空间，在带来方便的同时，也带来了访问冲突的问题。Java语言提供了专门机制以解决这种冲突，有效避免了同一个数据对象被多个线程同时访问造成的这种问题。</p>
<p>由于我们可以通过 private 关键字来保证数据对象只能被方法访问，所以我们只需针对方法提出一套机制，这套机制就是synchronized关键字，它包括两种用法：synchronized 方法和 synchronized 块。</p>
<p><strong>synchronized 方法</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span>  <span class="kd">synchronized</span>  <span class="kt">void</span> <span class="nf">accessVal</span><span class="o">(</span><span class="kt">int</span> <span class="n">newVal</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>synchronized 方法控制对“对象的类成员变量”的访问：每个对象对应一把锁，每个 synchronized 方法都必须获得调用该方法的对象的锁方能执行，否则所属线程阻塞，方法一旦执行，就独占该锁，直到从该方法返回时才将锁释放，此后被阻塞的线程方能获得该锁，重新进入可执行状态。</p>
<p><strong>synchronized块</strong></p>
<p>synchronized 方法的缺陷：若将一个大的方法声明为synchronized 将会大大影响效率。</p>
<p>Java 为我们提供了更好的解决办法，那就是 synchronized 块。 块可以让我们精确地控制到具体的“成员变量”，缩小同步的范围，提高效率。</p>
<p>synchronized 块：通过 synchronized关键字来声明synchronized 块，语法如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">synchronized</span><span class="o">(</span><span class="n">syncObject</span><span class="o">)</span>
　  <span class="o">{</span> 
　　 <span class="c1">//允许访问控制的代码 
</span><span class="c1"></span>　  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>多线程操作一个对象</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestSync</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Account</span> <span class="n">a1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Account</span><span class="o">(</span><span class="n">100</span><span class="o">,</span> <span class="s">&#34;高&#34;</span><span class="o">);</span>
        <span class="n">Drawing</span> <span class="n">draw1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Drawing</span><span class="o">(</span><span class="n">80</span><span class="o">,</span> <span class="n">a1</span><span class="o">);</span>
        <span class="n">Drawing</span> <span class="n">draw2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Drawing</span><span class="o">(</span><span class="n">80</span><span class="o">,</span> <span class="n">a1</span><span class="o">);</span>
        <span class="n">draw1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span> <span class="c1">// 你取钱
</span><span class="c1"></span>        <span class="n">draw2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span> <span class="c1">// 你老婆取钱
</span><span class="c1"></span>    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*
</span><span class="cm"> * 简单表示银行账户
</span><span class="cm"> */</span>
<span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">money</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">aname</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">Account</span><span class="o">(</span><span class="kt">int</span> <span class="n">money</span><span class="o">,</span> <span class="n">String</span> <span class="n">aname</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">money</span> <span class="o">=</span> <span class="n">money</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">aname</span> <span class="o">=</span> <span class="n">aname</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/**
</span><span class="cm"> * 模拟提款操作
</span><span class="cm"> * 
</span><span class="cm"> * @author Administrator
</span><span class="cm"> *
</span><span class="cm"> */</span>
<span class="kd">class</span> <span class="nc">Drawing</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">drawingNum</span><span class="o">;</span> <span class="c1">// 取多少钱
</span><span class="c1"></span>    <span class="n">Account</span> <span class="n">account</span><span class="o">;</span> <span class="c1">// 要取钱的账户
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">expenseTotal</span><span class="o">;</span> <span class="c1">// 总共取的钱数
</span><span class="c1"></span> 
    <span class="kd">public</span> <span class="nf">Drawing</span><span class="o">(</span><span class="kt">int</span> <span class="n">drawingNum</span><span class="o">,</span> <span class="n">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">drawingNum</span> <span class="o">=</span> <span class="n">drawingNum</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">account</span> <span class="o">=</span> <span class="n">account</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">draw</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">synchronized</span> <span class="o">(</span><span class="n">account</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">account</span><span class="o">.</span><span class="na">money</span> <span class="o">-</span> <span class="n">drawingNum</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;取款，余额不足！&#34;</span><span class="o">);</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">1000</span><span class="o">);</span> <span class="c1">// 判断完后阻塞。其他线程开始运行。
</span><span class="c1"></span>            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="n">account</span><span class="o">.</span><span class="na">money</span> <span class="o">-=</span> <span class="n">drawingNum</span><span class="o">;</span>
            <span class="n">expenseTotal</span> <span class="o">+=</span> <span class="n">drawingNum</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;--账户余额：&#34;</span> <span class="o">+</span> <span class="n">account</span><span class="o">.</span><span class="na">money</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;--总共取了：&#34;</span> <span class="o">+</span> <span class="n">expenseTotal</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>“synchronized (account)” 意味着线程需要获得account对象的“锁”才有资格运行同步块中的代码。 Account对象的“锁”也称为“互斥锁”，在同一时刻只能被一个线程使用。A线程拥有锁，则可以调用“同步块”中的代码;B线程没有锁，则进入account对象的“锁池队列”等待，直到A线程使用完毕释放了account对象的锁，B线程得到锁才可以开始调用“同步块”中的代码。</p>
<h2 id="死锁">死锁</h2>
<p><strong>死锁的概念</strong></p>
<p>“死锁”指的是：</p>
<p>多个线程各自占有一些共享资源，并且互相等待其他线程占有的资源才能进行，而导致两个或者多个线程都在等待对方释放资源，都停止执行的情形。</p>
<p>因此， 某一个同步块需要同时拥有“两个以上对象的锁”时，就可能会发生“死锁”的问题。下面案例中，“化妆线程”需要同时拥有“镜子对象”、“口红对象”才能运行同步块。那么，实际运行时，“小丫的化妆线程”拥有了“镜子对象”，“大丫的化妆线程”拥有了“口红对象”，都在互相等待对方释放资源，才能化妆。这样，两个线程就形成了互相等待，无法继续运行的“死锁状态”。</p>
<p><strong>【示例11-11】死锁问题演示</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">Lipstick</span> <span class="o">{</span><span class="c1">//口红类
</span><span class="c1"></span> 
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Mirror</span> <span class="o">{</span><span class="c1">//镜子类
</span><span class="c1"></span> 
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Makeup</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span><span class="c1">//化妆类继承了Thread类
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">flag</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">girl</span><span class="o">;</span>
    <span class="kd">static</span> <span class="n">Lipstick</span> <span class="n">lipstick</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Lipstick</span><span class="o">();</span>
    <span class="kd">static</span> <span class="n">Mirror</span> <span class="n">mirror</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mirror</span><span class="o">();</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// TODO Auto-generated method stub
</span><span class="c1"></span>        <span class="n">doMakeup</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="kt">void</span> <span class="nf">doMakeup</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">flag</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">lipstick</span><span class="o">)</span> <span class="o">{</span><span class="c1">//需要得到口红的“锁”；
</span><span class="c1"></span>                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">girl</span> <span class="o">+</span> <span class="s">&#34;拿着口红！&#34;</span><span class="o">);</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">1000</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
 
                <span class="kd">synchronized</span> <span class="o">(</span><span class="n">mirror</span><span class="o">)</span> <span class="o">{</span><span class="c1">//需要得到镜子的“锁”；
</span><span class="c1"></span>                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">girl</span> <span class="o">+</span> <span class="s">&#34;拿着镜子！&#34;</span><span class="o">);</span>
                <span class="o">}</span>
 
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">mirror</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">girl</span> <span class="o">+</span> <span class="s">&#34;拿着镜子！&#34;</span><span class="o">);</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">2000</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="kd">synchronized</span> <span class="o">(</span><span class="n">lipstick</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">girl</span> <span class="o">+</span> <span class="s">&#34;拿着口红！&#34;</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
<span class="o">}</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestDeadLock</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Makeup</span> <span class="n">m1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Makeup</span><span class="o">();</span><span class="c1">//大丫的化妆线程；
</span><span class="c1"></span>        <span class="n">m1</span><span class="o">.</span><span class="na">girl</span> <span class="o">=</span> <span class="s">&#34;大丫&#34;</span><span class="o">;</span>
        <span class="n">m1</span><span class="o">.</span><span class="na">flag</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="n">Makeup</span> <span class="n">m2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Makeup</span><span class="o">();</span><span class="c1">//小丫的化妆线程；
</span><span class="c1"></span>        <span class="n">m2</span><span class="o">.</span><span class="na">girl</span> <span class="o">=</span> <span class="s">&#34;小丫&#34;</span><span class="o">;</span>
        <span class="n">m2</span><span class="o">.</span><span class="na">flag</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>
        <span class="n">m1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">m2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>两线程都在等对方的资源，都处于停滞状态)</p>
<p><strong>死锁的解决方法</strong></p>
<p>死锁是由于“同步块需要同时持有多个对象锁造成”的，要解决这个问题，思路很简单，就是：同一个代码块，不要同时持有两个对象锁</p>
<h1 id="线程并发协作生产者消费者模式"><strong>线程并发协作(生产者/消费者模式)</strong></h1>
<p>多线程环境下，我们经常需要多个线程的并发和协作。这个时候，就需要了解一个重要的多线程并发协作模型“生产者/消费者模式”。</p>
<p><strong>Ø 什么是生产者?</strong></p>
<p>生产者指的是负责生产数据的模块(这里模块可能是：方法、对象、线程、进程)。</p>
<p><strong>Ø 什么是消费者?</strong></p>
<p>消费者指的是负责处理数据的模块(这里模块可能是：方法、对象、线程、进程)。</p>
<p><strong>Ø 什么是缓冲区?</strong></p>
<p>消费者不能直接使用生产者的数据，它们之间有个“缓冲区”。生产者将生产好的数据放入“缓冲区”，消费者从“缓冲区”拿要处理的数据</p>
<p>缓冲区是实现并发的核心，缓冲区的设置有3个好处：</p>
<p><strong>Ø 实现线程的并发协作</strong></p>
<p>有了缓冲区以后，生产者线程只需要往缓冲区里面放置数据，而不需要管消费者消费的情况;同样，消费者只需要从缓冲区拿数据处理即可，也不需要管生产者生产的情况。 这样，就从逻辑上实现了“生产者线程”和“消费者线程”的分离。</p>
<p><strong>Ø 解耦了生产者和消费者</strong></p>
<p>生产者不需要和消费者直接打交道。</p>
<p><strong>Ø 解决忙闲不均，提高效率</strong></p>
<p>生产者生产数据慢时，缓冲区仍有数据，不影响消费者消费;消费者处理数据慢时，生产者仍然可以继续往缓冲区里面放置数据 。</p>
<p><strong>线程并发协作总结：</strong></p>
<p>线程并发协作(也叫线程通信)，通常用于生产者/消费者模式，情景如下：</p>
<p>\1. 生产者和消费者共享同一个资源，并且生产者和消费者之间相互依赖，互为条件。</p>
<p>\2. 对于生产者，没有生产产品之前，消费者要进入等待状态。而生产了产品之后，又需要马上通知消费者消费。</p>
<p>\3. 对于消费者，在消费之后，要通知生产者已经消费结束，需要继续生产新产品以供消费。</p>
<p>\4. 在生产者消费者问题中，仅有synchronized是不够的。</p>
<p>​    · synchronized可阻止并发更新同一个共享资源，实现了同步;</p>
<p>​    · synchronized不能用来实现不同线程之间的消息传递(通信)。</p>
<p>\5. 那线程是通过哪些方法来进行消息传递(通信)的呢?见如下总结：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://www.sxt.cn/360shop/Public/admin/UEditor/20170526/1495792837120930.png"
        data-srcset="https://www.sxt.cn/360shop/Public/admin/UEditor/20170526/1495792837120930.png, https://www.sxt.cn/360shop/Public/admin/UEditor/20170526/1495792837120930.png 1.5x, https://www.sxt.cn/360shop/Public/admin/UEditor/20170526/1495792837120930.png 2x"
        data-sizes="auto"
        alt="https://www.sxt.cn/360shop/Public/admin/UEditor/20170526/1495792837120930.png"
        title="表11-2 线程通信常用方法.png" /></p>
<p>\6. 以上方法均是java.lang.Object类的方法;</p>
<p>都只能在同步方法或者同步代码块中使用，否则会抛出异常。</p>
<h1 id="任务定时调度"><strong>任务定时调度</strong></h1>
<p>通过Timer和Timetask，我们可以实现定时启动某个线程。</p>
<p><strong>java.util.Timer</strong></p>
<p>在这种实现方式中，Timer类作用是类似闹钟的功能，也就是定时或者每隔一定时间触发一次线程。其实，Timer类本身实现的就是一个线程，只是这个线程是用来实现调用其它线程的。</p>
<p><strong>java.util.TimerTask</strong></p>
<p>TimerTask类是一个抽象类，该类实现了Runnable接口，所以该类具备多线程的能力。</p>
<p>在这种实现方式中，通过继承TimerTask使该类获得多线程的能力，将需要多线程执行的代码书写在run方法内部，然后通过Timer类启动线程的执行。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestTimer</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Timer</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Timer</span><span class="o">();</span><span class="c1">//定义计时器；
</span><span class="c1"></span>        <span class="n">MyTask</span> <span class="n">task1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyTask</span><span class="o">();</span><span class="c1">//定义任务；
</span><span class="c1"></span>        <span class="n">t1</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="n">task1</span><span class="o">,</span><span class="n">3000</span><span class="o">);</span>  <span class="c1">//3秒后执行；
</span><span class="c1"></span>        <span class="c1">//t1.schedule(task1,5000,1000);//5秒以后每隔1秒执行一次！
</span><span class="c1"></span>        <span class="c1">//GregorianCalendar calendar1 = new GregorianCalendar(2010,0,5,14,36,57); 
</span><span class="c1"></span>        <span class="c1">//t1.schedule(task1,calendar1.getTime()); //指定时间定时执行； 
</span><span class="c1"></span>    <span class="o">}</span>
<span class="o">}</span>
 
<span class="kd">class</span> <span class="nc">MyTask</span> <span class="kd">extends</span> <span class="n">TimerTask</span> <span class="o">{</span><span class="c1">//自定义线程类继承TimerTask类；
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">10</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;任务1:&#34;</span><span class="o">+</span><span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>运行以上程序时，可以感觉到在输出之前有明显的延迟(大概就是3秒!)。还有几个方法，我注释掉了，大家自己试试吧!</p>
<p>在实际使用时，一个Timer可以启动任意多个TimerTask实现的线程，但是多个线程之间会存在阻塞。所以如果多个线程之间需要完全独立的话，最好还是一个Timer启动一个TimerTask实现。</p>
<p><strong>老鸟建议</strong></p>
<p>实际开发中，我们可以使用开源框架quanz，更加方便的实现任务定时调度。实际上，quanz底层原理就是我们这里介绍的内容。</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2020-01-20</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/posts/xian-cheng/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://yang419.com/posts/xian-cheng/" data-title="线程" data-via="xxxx" data-hashtags="Java"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://yang419.com/posts/xian-cheng/" data-hashtag="Java"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="分享到 WhatsApp" data-sharer="whatsapp" data-url="https://yang419.com/posts/xian-cheng/" data-title="线程" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://yang419.com/posts/xian-cheng/" data-title="线程"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://yang419.com/posts/xian-cheng/" data-title="线程" data-ralateuid="xxxx"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Myspace" data-sharer="myspace" data-url="https://yang419.com/posts/xian-cheng/" data-title="线程" data-description=""><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/myspace.svg"></i></a><a href="javascript:void(0);" title="分享到 Blogger" data-sharer="blogger" data-url="https://yang419.com/posts/xian-cheng/" data-title="线程" data-description=""><i class="fab fa-blogger fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Evernote" data-sharer="evernote" data-url="https://yang419.com/posts/xian-cheng/" data-title="线程"><i class="fab fa-evernote fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/java/">Java</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/io-liu/" class="prev" rel="prev" title="IO流"><i class="fas fa-angle-left fa-fw"></i>IO流</a>
            <a href="/posts/lambda/" class="next" rel="next" title="Lambda">Lambda<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.68.3">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Yang</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"G5ZHN05DPH","algoliaIndex":"Hugo","algoliaSearchKey":"179459d42cf71a1c7abbf4708e609149","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
